# Rust_Excercise

## 環境とエコシステム
- `rustup`: マルチプレクサ．Rustのツールチェーン(コンパイラ`rustc`，パッケージマネージャ`cargo等`)のバージョン管理を行う．
- `cargo`: ビルドシステム兼パッケージマネージャ．依存関係の解決，コンパイル，テスト，ドキュメント生成を一手に担う．C++における`make`+`cmake`+`conan`+`doxygen`を統合した存在であり，プロジェクトの宣言的定義を可能にする．

## 束縛と不変性
- Rustにおいて`let x = 5`は「代入」ではなく**「束縛(Binding)」**と呼ばれる．
- 数学的な定義x:=5に近く，スコープ内での普遍の事実を宣言する．
- これはデフォルトで「不変（Immutable）」．
- `Default: x -> y`（変更不可）
- `Mutable: let mut x -> v`（変更可能）
- 状態が変わることを特権的な操作として命じさせる（`mut`）ことで，データ競合の発生源を局所化する．
- 何が可変で何が不変なのか，表現したい物自体への理解が必要．いいね．

## インストール
- 公式からrustをインストール
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

- PATHを通す
```bash
source $HOME/.cargo/env
```

## 実行
- ディレクトリ内で以下の`cargo`コマンドを使う
- コンパイルから実行まで
```bash
cargo run
```

- コンパイルのみ
```bash
cargo build
```

- 生成なしの高速構文チェック
```bash
cargo check
```

## 制御構造の式性
- Rustにおいて`if`は制御文ではなく「式」-> 値を返す．
`let y = if x > 5 {10} else {0}`
- この性質により，条件分岐の結果を直接，不変変数に束縛できる．
- 変数をmutにしてあとから条件分岐で代入する必要がない->不変性を維持しやすい

## ループと状態
- `loop`: 無限ループ．明示的に`break`するまで続く．`break value;`で値を返せる．
- `while`: 条件付きループ．
- `for`: イテレータを用いたループ．範囲`0..5`や配列の中身を走査する．

## シャドーイングによる純粋性の模倣
- 物理計算において「時間tの位置x」と「時間t+1の位置x」は，概念上は別の物体である．
- Rustでは**シャドーイング**を用いることで，`mut`を使わずにこれを表現できる．
```rust
let x = 5; // 初期のx
let x = x + 1; // 新しいx（初期のxは隠蔽される）
```

- 「変数の値を書き換える」のではなく，「同じ名前の新しい変数を定義し直す」操作->古いxはアクセス不能だが，不変性の規律は守られる（過去は振り返らない，ぜ）．

## 文と式
- `;`は単なる区切り記号ではない
- 式: 値を返す．例: `y < 0.0`(boolを返す)，`{ 5 }`(5を返す)．
- 文: 値を返さない(ユニット型`()`を返す)．例: `let x = 5;`，`println!...;`. 式の末尾に`;`をつけると，その評価値は捨てられ，式は文に「退化」する．
- `if`文において`;`によって`()`を返してしまい，型不整合が起きた．

## 計算と制御の分離
- 例えば物理エンジンの内部では「衝突した事実」と「シミュレーションを止める判断は」別の関心事．
- `if文`を計算用と制御用で分ける->計算用の方では今の状態のログだけを渡し，制御用の方で，ログに基づいた制御(`break`か`continue`か)をする．

## 所有権の三原則
1. Rustの各値は**所有者（Owner）**と呼ばれる変数と対応している．
2. いかなる時も，所有者は**ただ一人**である．
3. 所有者がスコープ(`{}`)から外れたとき，値は**破棄（Drop）**される．

## Move（移動）とCopy（コピー）
- データサイズが小さく固定された量では，代入時にビット列が自動的に複製される->**Copyトレイト**の実装という．
```rust
let a = 5; let b = a; -> aもbも有効
```

- `String`や配列などのヒープ領域を使うデータは，複製コストが高い->Rustはデフォルトで「所有権の移動（Move）」を行う．
```rust
let s1 = String::from("hello");
let s2 = s1; -> s1は無効化(Invalidated!)
```

- これを**Moveセマンティクス**と呼ぶ．所有権は渡したら手元に残らない．
